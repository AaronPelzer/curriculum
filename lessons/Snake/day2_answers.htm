<html>
<canvas id="game" width="400" height="400"></canvas>
<script>
// globals
var NBLOCKS=40;
var canvas=document.getElementById('game');
var ctx=canvas.getContext('2d');
var gamestate={
  direction:[1,0],
  blocks:[[0,0],[1,0],[2,0]],
};

function draw_block(block,color){
  // helper for draw_snake
  var w=ctx.canvas.width,h=ctx.canvas.height;
  var x=block[0],y=block[1];
  ctx.fillStyle=color;
  if (x>=NBLOCKS || y>=NBLOCKS) throw "bad block coordinate";
  var dx=w/NBLOCKS,dy=h/NBLOCKS;
  ctx.fillRect(x*dx,y*dy,dx-1,dy-1);
}
function block_in_range(block){
  // returns bool for whether block is onscreen
  var x=block[0],y=block[1];
  return x>=0 && y>=0 && x<NBLOCKS-1 && y<NBLOCKS-1;
}
function draw_blocks(blocks,color){
  // takes an array of blocks and draws them. each block is a 2d coordinate [x,y].
  for (var i=0;i<blocks.length;++i)
    draw_block(blocks[i],color);
}
function update_snake(){
  var blocks=gamestate.blocks;
  blocks=blocks.slice(1);
  var last=blocks[blocks.length-1];
  var d=gamestate.direction;
  var next=[last[0]+d[0],last[1]+d[1]];
  blocks.push(next);
  gamestate.blocks=blocks;
}
function fill(color){
  // this clears the game screen. call it at the beginning of every frame
  var w=ctx.canvas.width,h=ctx.canvas.height;
  ctx.fillStyle=color;
  ctx.fillRect(0,0,w,h);
  ctx.strokeStyle="black";
  ctx.strokeRect(0,0,w,h);
}
function clear(){
  fill('#0f0');
}
function onframe(){
  if (!block_in_range(gamestate.blocks[gamestate.blocks.length-1]))
    gamestate.failed=true;
  if (gamestate.failed)
    fill('#f00');
  else {
    clear();
    update_snake();
    draw_blocks(gamestate.blocks,'#f0f');
    draw_blocks(gamestate.apples,'#000');
  }
}

// one-time setup
setInterval(onframe,100);

function keyup(event){
  switch(event.keyCode){
  case 38:
    gamestate.direction = [0,-1]; // up
    break;
  case 40:
    gamestate.direction = [0,1]; // down
    break;
  case 37:
    gamestate.direction = [-1,0]; // left
    break;
  case 39:
    gamestate.direction = [1,0]; // right
    break;
  }
}
document.onkeyup=keyup;

function make_apple(){
  var x=Math.round(Math.random()*NBLOCKS),y=Math.round(Math.random()*NBLOCKS);
  return [x,y];
}
function make_apples(N){
  gamestate.apples = [];
  for (var i=0;i<N;++i)
    gamestate.apples.push(make_apple());
}
make_apples(2);
</script>
</html>